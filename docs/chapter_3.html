<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Diseño y construcción del DTHIS-C – Desarrollo e implementación con tecnologías libres de un dispositivo portátil para evaluar el confort térmico, lumínico y acústico en interiores</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chapter_4.html" rel="next">
<link href="./chapter_2.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8da5b4427184b79ecddefad3d342027e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Buscar"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chapter_3.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Diseño y construcción del DTHIS-C</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Buscar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Resumen</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introducción al confort en espacios interiores y el desarrollo del DTHIS-C</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Confort y calidad del aire en espacios interiores</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Diseño y construcción del DTHIS-C</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Calibración y referenciación del DTHIS-C</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Conclusiones</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bibliografía</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contenido</h2>
   
  <ul>
  <li><a href="#sec-especificaciones" id="toc-sec-especificaciones" class="nav-link active" data-scroll-target="#sec-especificaciones"><span class="header-section-number">3.1</span> Especificaciones del DTHIS-C</a></li>
  <li><a href="#sec-diseno" id="toc-sec-diseno" class="nav-link" data-scroll-target="#sec-diseno"><span class="header-section-number">3.2</span> Diseño del DTHIS-C</a>
  <ul>
  <li><a href="#arduino-uno-wifi-rev2" id="toc-arduino-uno-wifi-rev2" class="nav-link" data-scroll-target="#arduino-uno-wifi-rev2"><span class="header-section-number">3.2.1</span> Arduino UNO WiFi Rev2</a>
  <ul class="collapse">
  <li><a href="#termopar-tipo-t" id="toc-termopar-tipo-t" class="nav-link" data-scroll-target="#termopar-tipo-t">Termopar Tipo T</a></li>
  <li><a href="#pwfusion-max31856-sen-30007" id="toc-pwfusion-max31856-sen-30007" class="nav-link" data-scroll-target="#pwfusion-max31856-sen-30007">PWFusion MAX31856 SEN-30007</a></li>
  <li><a href="#fuehler-systeme-tpf1e-20-pt1000" id="toc-fuehler-systeme-tpf1e-20-pt1000" class="nav-link" data-scroll-target="#fuehler-systeme-tpf1e-20-pt1000">Fuehler Systeme TPF1/E-20 PT1000</a></li>
  <li><a href="#adafruit-pt1000-rtd-max31865" id="toc-adafruit-pt1000-rtd-max31865" class="nav-link" data-scroll-target="#adafruit-pt1000-rtd-max31865">Adafruit PT1000 RTD-MAX31865</a></li>
  <li><a href="#modern-device-wind-sensor-rev.-p6" id="toc-modern-device-wind-sensor-rev.-p6" class="nav-link" data-scroll-target="#modern-device-wind-sensor-rev.-p6">Modern Device Wind Sensor Rev.&nbsp;P6</a></li>
  </ul></li>
  <li><a href="#raspberry-pi-4-model-b" id="toc-raspberry-pi-4-model-b" class="nav-link" data-scroll-target="#raspberry-pi-4-model-b"><span class="header-section-number">3.2.2</span> Raspberry Pi 4 Model B</a>
  <ul class="collapse">
  <li><a href="#sensirion-scd30" id="toc-sensirion-scd30" class="nav-link" data-scroll-target="#sensirion-scd30">Sensirion SCD30</a></li>
  <li><a href="#arducam-5mp-ov5647-ultra-wide-angle" id="toc-arducam-5mp-ov5647-ultra-wide-angle" class="nav-link" data-scroll-target="#arducam-5mp-ov5647-ultra-wide-angle">Arducam 5MP OV5647 Ultra Wide Angle</a></li>
  <li><a href="#micrófono-ambiental-usb" id="toc-micrófono-ambiental-usb" class="nav-link" data-scroll-target="#micrófono-ambiental-usb">Micrófono ambiental USB</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-materiales" id="toc-sec-materiales" class="nav-link" data-scroll-target="#sec-materiales"><span class="header-section-number">3.3</span> Lista de materiales</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="cap-construccion" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Diseño y construcción del DTHIS-C</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>En este capítulo se presenta una descripción detallada del DTHIS-C, incluyendo sus componentes y especificaciones técnicas. Además, se proporcionan los diagramas de conexión y los códigos necesarios para la configuración de cada sensor, facilitando tanto la reproducción completa del DTHIS-C como la implementación individual de sus sensores.</p>
<section id="sec-especificaciones" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-especificaciones"><span class="header-section-number">3.1</span> Especificaciones del DTHIS-C</h2>
<p>En la <a href="#tbl-componentes" class="quarto-xref">Tabla&nbsp;<span>3.1</span></a> se muestran los sensores y componentes electrónicos que conforman al DTHIS-C.</p>
<div id="tbl-componentes" class="hover sm quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-componentes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;3.1: Sensores y componentes electrónicos que consitutyen al DTHIS-C.
</figcaption>
<div aria-describedby="tbl-componentes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-hover table-sm small caption-top table">
<colgroup>
<col style="width: 29%">
<col style="width: 22%">
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Sensor</strong></th>
<th><strong>Variable</strong></th>
<th><strong>Comunicación</strong></th>
<th><strong>Microcontrolador</strong></th>
<th><strong>Acondicionador de señal</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Termopar tipo T</td>
<td>Temperatura ambiente</td>
<td>ICSP</td>
<td>Arduino UNO WiFi Rev2</td>
<td>PWFusion MAX31856 SEN-30007</td>
</tr>
<tr class="even">
<td>TPF1/E-20 PT1000</td>
<td>Temperatura radiante</td>
<td>ICSP</td>
<td>Arduino UNO WiFi Rev2</td>
<td>Adafruit PT1000 RTD-MAX31865</td>
</tr>
<tr class="odd">
<td>Wind Sensor Rev P6</td>
<td>Velocidad del viento</td>
<td>ADC</td>
<td>Arduino UNO WiFi Rev2</td>
<td></td>
</tr>
<tr class="even">
<td>SCD30 Sensirion</td>
<td>CO<sub>2</sub> y humedad relativa</td>
<td>I2C</td>
<td>Raspberry Pi 4 Model B</td>
<td></td>
</tr>
<tr class="odd">
<td>5MP OV5647 Wide Angle Fisheye Camera</td>
<td>Luminancia</td>
<td>CSI</td>
<td>Raspberry Pi 4 Model B</td>
<td></td>
</tr>
<tr class="even">
<td>Micrófono ambiental USB</td>
<td>Sonido</td>
<td>USB</td>
<td>Raspberry Pi 4 Model B</td>
<td></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="sec-diseno" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-diseno"><span class="header-section-number">3.2</span> Diseño del DTHIS-C</h2>
<p>La arquitectura del DTHIS-C se ha fundamentado en el uso combinado de la Raspberry Pi 4 y el Arduino Uno WiFi Rev2, microcontroladores seleccionados por las siguientes características y ventajas:</p>
<ol type="1">
<li><p><strong>Versatilidad y capacidad de procesamiento:</strong><br>
La Raspberry Pi 4, programada mediante Python, proporciona una plataforma robusta para el procesamiento avanzado de datos y la ejecución de algoritmos complejos. Su flexibilidad, junto con la facilidad de integración de diversas funcionalidades, permite adaptar el sistema a requerimientos específicos y optimizar el rendimiento según las demandas del entorno.</p></li>
<li><p><strong>Conectividad y eficiencia en la adquisición de datos:</strong><br>
Ambos dispositivos cuentan con conectividad a Internet, lo que posibilita la transmisión en tiempo real de datos hacia una base de datos remota alojada en el servidor ThingsBoard. Además, el Arduino Uno WiFi Rev2 destaca por su eficiencia en la gestión de operaciones de entrada/salida, garantizando una respuesta rápida y precisa en la adquisición y control de los sensores.</p></li>
<li><p><strong>Compatibilidad y ecosistema abierto:</strong><br>
La adopción de tecnologías abiertas facilita la integración y reproducibilidad del sistema. La amplia comunidad de desarrolladores que respalda tanto la Raspberry Pi como el Arduino asegura soporte continuo, actualizaciones regulares y una extensa variedad de recursos y librerías, lo que se traduce en mayor flexibilidad para adaptar el sistema a diversas necesidades y entornos.</p></li>
<li><p><strong>Accesibilidad:</strong><br>
Frente a equipos especializados, la utilización de estos microcontroladores constituye una solución rentable sin comprometer el rendimiento ni la fiabilidad del sistema. Esta ventaja económica facilita la replicación y el escalado del proyecto en distintos contextos.</p></li>
</ol>
<p>A continuación, se detallan las especificaciones técnicas y el código implementado para cada sensor.</p>
<section id="arduino-uno-wifi-rev2" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="arduino-uno-wifi-rev2"><span class="header-section-number">3.2.1</span> Arduino UNO WiFi Rev2</h3>
<p>El Arduino UNO WiFi Rev2 es una placa de microcontrolador diseñada para proyectos de Internet de las Cosas (IoT), integrando conectividad WiFi y Bluetooth mediante el módulo u-blox NINA-W102 y un sensor IMU de 6 ejes (LSM6DS3TR) para detección de movimientos. Equipada con el microcontrolador ATmega4809, ofrece una óptima capacidad de memoria, y mantiene compatibilidad con el formato estándar UNO, facilitando su uso con shields existentes. Su diseño eficiente y versátil lo hace ideal para la adquisición de datos de sensores y la comunicación inalámbrica en tiempo real, como se requiere en el DTHIS-C. <span class="citation" data-cites="arduino">Arduino (<a href="references.html#ref-arduino" role="doc-biblioref">2023</a>)</span></p>
<p>En la <a href="#tbl-arduino" class="quarto-xref">Tabla&nbsp;<span>3.2</span></a> se muestran sus especificaciones.</p>
<div id="tbl-arduino" class="hover sm quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-arduino-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;3.2: Especificaciones del Arduino UNO WiFi Rev2.
</figcaption>
<div aria-describedby="tbl-arduino-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-hover table-sm small caption-top table">
<colgroup>
<col style="width: 37%">
<col style="width: 62%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Parámetro</strong></th>
<th><strong>Detalle</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Microcontrolador</td>
<td>ATmega4809</td>
</tr>
<tr class="even">
<td>Memoria flash</td>
<td>48 KB</td>
</tr>
<tr class="odd">
<td>SRAM</td>
<td>6,144 Bytes</td>
</tr>
<tr class="even">
<td>EEPROM</td>
<td>256 Bytes</td>
</tr>
<tr class="odd">
<td>Conectividad Wi-Fi</td>
<td>Sí, u-blox NINA-W102 (2.4 GHz)</td>
</tr>
<tr class="even">
<td>Bluetooth</td>
<td>Sí, Bluetooth Low Energy</td>
</tr>
<tr class="odd">
<td>Sensor IMU</td>
<td>Sí, LSM6DS3TR (6 ejes)</td>
</tr>
<tr class="even">
<td>Pines digitales I/O</td>
<td>14 (5 PWM)</td>
</tr>
<tr class="odd">
<td>Pines analógicos</td>
<td>6</td>
</tr>
<tr class="even">
<td>Voltaje de operación</td>
<td>5V</td>
</tr>
<tr class="odd">
<td>Consumo máximo total</td>
<td>200 mA</td>
</tr>
<tr class="even">
<td>Dimensiones</td>
<td>68.6 mm x 53.4 mm</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>El siguiente código constituye el programa principal del Arduino UNO WiFi Rev2 en el DTHIS-C, encargado de gestionar la conexión WiFi, la comunicación con ThingsBoard mediante el protocolo MQTT, y el envío de datos provenientes de sensores como termopares, temperatura radiante y velocidad del viento:</p>
<div id="58bc820a" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-overflow-wrap code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#include &lt;WiFiNINA.h&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#include &lt;PubSubClient.h&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Definiciones para la red WiFi y ThingsBoard</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#define WIFI_AP "IER"          </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#define WIFI_PASSWORD "acadier2014" </span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#define TOKEN "bXQq1eepFYJV3nldvLTV"</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#define THINGSBOARD_SERVER "tb.ier.unam.mx"</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#define MQTT_PORT 1883</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Inicialización de las librerías y objetos</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>WiFiClient espClient<span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>PubSubClient mqttClient(espClient)<span class="op">;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Configuración inicial <span class="kw">del</span> dispositivo.</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Configura la conexión WiFi y el cliente MQTT para ThingsBoard.</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>void setup() {</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  WiFi.begin(WIFI_AP, WIFI_PASSWORD)<span class="op">;</span>  <span class="op">//</span> Conectar a la red WiFi</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (WiFi.status() <span class="op">!=</span> WL_CONNECTED) {</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    delay(<span class="dv">500</span>)<span class="op">;</span>  <span class="op">//</span> Espera hasta conectarse</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  mqttClient.setServer(THINGSBOARD_SERVER, MQTT_PORT)<span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  connectToThingsBoard()<span class="op">;</span>  <span class="op">//</span> Conectar a ThingsBoard</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Ciclo principal <span class="kw">del</span> programa.</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Mantiene las conexiones y realiza las tareas periódicas.</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>void loop() {</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (WiFi.status() <span class="op">!=</span> WL_CONNECTED) {</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    reconnectWiFi()<span class="op">;</span>  <span class="op">//</span> Reconecta WiFi si es necesario</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>mqttClient.connected()) {</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    reconnectThingsBoard()<span class="op">;</span>  <span class="op">//</span> Reconecta MQTT si es necesario</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Obtener las mediciones de los termopares (temperaturas)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="bu">float</span><span class="op">*</span> temperatures <span class="op">=</span> ThermocoupleTemp()<span class="op">;</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  sendTC(temperatures)<span class="op">;</span>    <span class="op">//</span> Enviar temperaturas a ThingsBoard</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Obtener la temperatura <span class="kw">del</span> TPF1</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="bu">float</span> radiant <span class="op">=</span> TPF1Temp()<span class="op">;</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  sendRT(radiant)<span class="op">;</span>  <span class="op">//</span> Enviar temperatura radiante a ThingsBoard</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Obtener la velocidad promedio <span class="kw">del</span> viento</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  <span class="bu">float</span><span class="op">*</span> windspeed <span class="op">=</span> WindSensor()<span class="op">;</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  sendWS(windspeed)<span class="op">;</span>      <span class="op">//</span> Enviar velocidad <span class="kw">del</span> viento a ThingsBoard</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  mqttClient.loop()<span class="op">;</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  delay(<span class="dv">2000</span>)<span class="op">;</span>  <span class="op">//</span> Espera <span class="dv">2</span> segundos antes de la siguiente iteración</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Conecta a la red WiFi.</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>void connectWiFi() {</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  WiFi.begin(WIFI_AP, WIFI_PASSWORD)<span class="op">;</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (WiFi.status() <span class="op">!=</span> WL_CONNECTED) {</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    delay(<span class="dv">500</span>)<span class="op">;</span>  <span class="op">//</span> Espera hasta conectarse</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Reconecta a la red WiFi si es necesario.</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>void reconnectWiFi() {</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (WiFi.status() <span class="op">!=</span> WL_CONNECTED) {</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    WiFi.begin(WIFI_AP, WIFI_PASSWORD)<span class="op">;</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    delay(<span class="dv">500</span>)<span class="op">;</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Reconecta a ThingsBoard si es necesario.</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>void reconnectThingsBoard() {</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="op">!</span>mqttClient.connected()) {</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    connectToThingsBoard()<span class="op">;</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    delay(<span class="dv">5000</span>)<span class="op">;</span>  <span class="op">//</span> Espera antes de reintentar</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Conecta a ThingsBoard usando el token de autenticación.</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a><span class="bu">bool</span> connectToThingsBoard() {</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> mqttClient.<span class="ex">connect</span>(<span class="st">"ArduinoClient"</span>, TOKEN, NULL)<span class="op">;</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Envía los datos de temperatura.</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>void sendTC(<span class="bu">float</span><span class="op">*</span> temperatures) {</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>  String topic <span class="op">=</span> <span class="st">"v1/devices/me/telemetry"</span><span class="op">;</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>  String payload <span class="op">=</span> <span class="st">"{</span><span class="ch">\"</span><span class="st">T1</span><span class="ch">\"</span><span class="st">:"</span> <span class="op">+</span> String(temperatures[<span class="dv">0</span>]) <span class="op">+</span> </span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>                   <span class="st">", </span><span class="ch">\"</span><span class="st">T2</span><span class="ch">\"</span><span class="st">:"</span> <span class="op">+</span> String(temperatures[<span class="dv">1</span>]) <span class="op">+</span> </span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>                   <span class="st">", </span><span class="ch">\"</span><span class="st">T3</span><span class="ch">\"</span><span class="st">:"</span> <span class="op">+</span> String(temperatures[<span class="dv">2</span>]) <span class="op">+</span> </span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>                   <span class="st">", </span><span class="ch">\"</span><span class="st">T4</span><span class="ch">\"</span><span class="st">:"</span> <span class="op">+</span> String(temperatures[<span class="dv">3</span>]) <span class="op">+</span> <span class="st">"}"</span><span class="op">;</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>  mqttClient.publish(topic.c_str(), payload.c_str())<span class="op">;</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Envía los datos de temperatura radiante.</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>void sendRT(<span class="bu">float</span> radiant) {</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>  String topic <span class="op">=</span> <span class="st">"v1/devices/me/telemetry"</span><span class="op">;</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>  String payload <span class="op">=</span> <span class="st">"{</span><span class="ch">\"</span><span class="st">TR</span><span class="ch">\"</span><span class="st">:"</span> <span class="op">+</span> String(radiant) <span class="op">+</span> <span class="st">"}"</span><span class="op">;</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>  mqttClient.publish(topic.c_str(), payload.c_str())<span class="op">;</span>  </span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Envía los datos de velocidad <span class="kw">del</span> viento.</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>void sendWS(<span class="bu">float</span><span class="op">*</span> windspeed) {</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>  String topic <span class="op">=</span> <span class="st">"v1/devices/me/telemetry"</span><span class="op">;</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>  String payload <span class="op">=</span> <span class="st">"{</span><span class="ch">\"</span><span class="st">WS</span><span class="ch">\"</span><span class="st">:"</span> <span class="op">+</span> String(windspeed[<span class="dv">0</span>]) <span class="op">+</span> </span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>                   <span class="st">", </span><span class="ch">\"</span><span class="st">TEMP</span><span class="ch">\"</span><span class="st">:"</span> <span class="op">+</span> String(windspeed[<span class="dv">1</span>]) <span class="op">+</span> <span class="st">"}"</span><span class="op">;</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>  mqttClient.publish(topic.c_str(), payload.c_str())<span class="op">;</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="termopar-tipo-t" class="level4">
<h4 class="anchored" data-anchor-id="termopar-tipo-t">Termopar Tipo T</h4>
<p>En la construcción del DTHIS se emplea un termopar tipo T, un sensor de temperatura compuesto por la unión de cobre y cobre-níquel. Su uso es ideal para entornos con humedad.</p>
<p>A continuación, se presentan sus especificaciones según <span class="citation" data-cites="omega">OMEGA (<a href="references.html#ref-omega" role="doc-biblioref">s.&nbsp;f.</a>)</span>:</p>
<p><strong>Rangos de Temperatura</strong><br>
- <strong>Grado de termopar:</strong> -200 a 350 °C (-328 a 662 °F).<br>
- <strong>Grado de extensión:</strong> -60 a 100 °C (-76 a 212 °F).</p>
<p><strong>Límites de Error</strong><br>
- <strong>Estándar:</strong><br>
- ±1.0 °C o ±0.75% por encima de 0 °C.<br>
- ±1.0 °C o ±1.5% por debajo de 0 °C.<br>
- <strong>Especial:</strong><br>
- ±0.5 °C o ±0.4%.</p>
</section>
<section id="pwfusion-max31856-sen-30007" class="level4">
<h4 class="anchored" data-anchor-id="pwfusion-max31856-sen-30007">PWFusion MAX31856 SEN-30007</h4>
<p>El PWFusion MAX31856 SEN-30007 es un shield de termopares de cuatro canales diseñado para integrarse con la plataforma Arduino. Este dispositivo se conecta directamente a la placa de desarrollo. El módulo acondiciona la señal proveniente de termopares, realizando el procesamiento necesario para adaptar y amplificar la señal eléctrica, la cual se caracteriza por su baja amplitud.</p>
<div id="fig-MAX31856" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-MAX31856-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src=".\images/sen30007_bb.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-MAX31856-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.1: Diagrama de conexión para el shield MAX31856 SEN-30007.
</figcaption>
</figure>
</div>
<p>Acorde a <span class="citation" data-cites="pwf">PWFusion (<a href="references.html#ref-pwf" role="doc-biblioref">s.&nbsp;f.</a>)</span> sus específicaciones son las siguientes:</p>
<ul>
<li>Conversión de señal analógica a digital con resolución de 19 bits.</li>
<li>Interfaz ICSP de 4 hilos.</li>
<li>Rango de voltaje de alimentación: 3.3 V a 5.0 V.</li>
</ul>
<p>Igualmente se proporciona el código de Arduino empleado:</p>
<div id="f4a1c8a3" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-overflow-wrap code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#include &lt;PWFusion_MAX31856.h&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Definición de los pines chip select para cada termopar</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>uint8_t tcChipSelects[] <span class="op">=</span> {<span class="dv">10</span>, <span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">7</span>}<span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#define NUM_THERMOCOUPLES   (sizeof(tcChipSelects) / sizeof(uint8_t))</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Coeficientes de calibración para cada termopar</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>const <span class="bu">float</span> m[NUM_THERMOCOUPLES] <span class="op">=</span> {<span class="fl">1.0450</span>, <span class="fl">1.0602</span>, <span class="fl">1.0814</span>, <span class="fl">1.0554</span>}<span class="op">;</span>  <span class="op">//</span> Pendientes</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>const <span class="bu">float</span> b[NUM_THERMOCOUPLES] <span class="op">=</span> {<span class="op">-</span><span class="fl">2.4327</span>, <span class="op">-</span><span class="fl">2.8632</span>, <span class="op">-</span><span class="fl">4.4316</span>, <span class="op">-</span><span class="fl">3.9348</span>}<span class="op">;</span>  <span class="op">//</span> Intersecciones</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Se crea un objeto MAX31856 para cada termopar</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>MAX31856 thermocouples[NUM_THERMOCOUPLES]<span class="op">;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="bu">float</span><span class="op">*</span> ThermocoupleTemp() {</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  static <span class="bu">float</span> tc_temps[NUM_THERMOCOUPLES]<span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  static <span class="bu">bool</span> initialized <span class="op">=</span> false<span class="op">;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Inicializa los sensores solo la primera vez que se llama a la función</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>initialized) {</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    delay(<span class="dv">1000</span>)<span class="op">;</span>  <span class="op">//</span> Espera para la estabilización de los sensores</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="bu">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> NUM_THERMOCOUPLES<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>      thermocouples[i].begin(tcChipSelects[i])<span class="op">;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>      thermocouples[i].config(T_TYPE, CUTOFF_60HZ, AVG_SEL_4SAMP, CMODE_OFF)<span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    initialized <span class="op">=</span> true<span class="op">;</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Inicia la medición en cada sensor</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="bu">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> NUM_THERMOCOUPLES<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    thermocouples[i].startOneShotMeasurement()<span class="op">;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Espera el tiempo necesario para que la conversión se complete</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  delay(<span class="dv">180</span>)<span class="op">;</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Actualiza la muestra en cada sensor</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="bu">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> NUM_THERMOCOUPLES<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    thermocouples[i].sample()<span class="op">;</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Obtiene la temperatura ambiente de cada sensor y aplica la calibración</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="bu">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> NUM_THERMOCOUPLES<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (thermocouples[i].getStatus() <span class="op">!=</span> <span class="dv">0</span>) {</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>      <span class="op">//</span> En caso de error, se asigna NaN (Not a Number)</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>      tc_temps[i] <span class="op">=</span> NAN<span class="op">;</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>      <span class="bu">float</span> raw_temperature <span class="op">=</span> thermocouples[i].getTemperature()<span class="op">;</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>      tc_temps[i] <span class="op">=</span> m[i] <span class="op">*</span> raw_temperature <span class="op">+</span> b[i]<span class="op">;</span>  <span class="op">//</span> Aplica la calibración</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> tc_temps<span class="op">;</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fuehler-systeme-tpf1e-20-pt1000" class="level4">
<h4 class="anchored" data-anchor-id="fuehler-systeme-tpf1e-20-pt1000">Fuehler Systeme TPF1/E-20 PT1000</h4>
<p>Se empleó el TPF1/E-20 PT1000, diseñado para medir la temperatura radiante en un rango de temperaturas de -30 °C a +75 °C. Su sonda de temperatura, basada en la tecnología PT1000, se puede montar como un péndulo libremente suspendido, lo que permite obtener mediciones precisas de la temperatura de sensación térmica en entornos donde la convección natural y la estratificación del aire pueden influir en los resultados. <span class="citation" data-cites="fuehler">FuehlerSysteme (<a href="references.html#ref-fuehler" role="doc-biblioref">s.&nbsp;f.</a>)</span></p>
<p><strong>Especificaciones</strong></p>
<ul>
<li>Tipo de circuito: Conexión de 2 hilos.</li>
<li>Corriente de medición: Aproximadamente 1 mA.</li>
<li>Conexión eléctrica: Extremos pelados con terminales.</li>
<li>Cable: Cable de PVC (2×0,25 mm<sup>2</sup>, temperatura máxima +105 °C) con extremos de cable núcleo disponibles en diferentes longitudes.</li>
<li>Resistencia de fuga: Mayor a 100 M<span class="math inline">\(\Omega\)</span> a +20 °C (500 V DC).</li>
<li>Material del globo: Aluminio (negro).</li>
<li>Dimensiones del globo: Diámetro de 70 mm.</li>
</ul>
</section>
<section id="adafruit-pt1000-rtd-max31865" class="level4">
<h4 class="anchored" data-anchor-id="adafruit-pt1000-rtd-max31865">Adafruit PT1000 RTD-MAX31865</h4>
<p>El PT1000 RTD-MAX31865 es un convertidor de resistencia a digital.</p>
<div id="fig-MAX31865" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-MAX31865-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src=".\images/pt1000_bb.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-MAX31865-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.2: Diagrama de conexión para el PT1000 RTD-MAX31865.
</figcaption>
</figure>
</div>
<p><span class="citation" data-cites="adafruit">Adafruit (<a href="references.html#ref-adafruit" role="doc-biblioref">s.&nbsp;f.</a>)</span> describe las siguientes características:</p>
<ul>
<li>Realiza la conversión de la resistencia de sensores RTD de platino a un valor digital de forma sencilla.</li>
<li>Soporte con RTD de platino con valores de 100 <span class="math inline">\(\Omega\)</span> a 1 k<span class="math inline">\(\Omega\)</span> (a 0 °C), abarcando desde PT100 hasta PT1000.</li>
<li>Compatible con configuraciones de 2, 3 y 4 hilos para la conexión de sensores.</li>
<li>Incorpora una interfaz ICSP, facilitando su integración en sistemas basados en microcontroladores.</li>
<li>Cuenta con un ADC de 15 bits que proporciona una resolución nominal de temperatura de 0.03125 °C (valor variable debido a la no linealidad del RTD) y una precisión total de hasta 0.5 °C (0.05% de la escala completa) en todas las condiciones operativas.</li>
<li>Tiempo máximo de conversión es de 21 ms.</li>
</ul>
<p>A continuación se muestra el código de Arduino:</p>
<div id="b0e465ec" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-overflow-wrap code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#include &lt;Adafruit_MAX31865.h&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Usamos software SPI: CS, DI, DO, CLK</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>Adafruit_MAX31865 thermo <span class="op">=</span> Adafruit_MAX31865(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>)<span class="op">;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Para hardware SPI solo se pasa el pin CS</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Adafruit_MAX31865 thermo <span class="op">=</span> Adafruit_MAX31865(<span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#define RREF      4300.0  // Resistor de referencia (usa 430.0 para PT100 o 4300.0 para PT1000)</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#define RNOMINAL  1000.0  // Resistencia nominal a 0°C (100.0 para PT100, 1000.0 para PT1000)</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Función que realiza la medición y retorna la temperatura radiante en grados Celsius.</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="bu">float</span> TPF1Temp() {</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Inicializa el sensor solo la primera vez que se llama a la función.</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  static <span class="bu">bool</span> initialized <span class="op">=</span> false<span class="op">;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>initialized) {</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    thermo.begin(MAX31865_2WIRE)<span class="op">;</span>  <span class="op">//</span> Inicialización <span class="kw">del</span> MAX31865</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    initialized <span class="op">=</span> true<span class="op">;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Lectura <span class="kw">del</span> valor RTD</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  uint16_t rtd <span class="op">=</span> thermo.readRTD()<span class="op">;</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Calcula la razón y la resistencia (opcional si se requiere para otros cálculos)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="bu">float</span> ratio <span class="op">=</span> rtd <span class="op">/</span> <span class="fl">32768.0</span><span class="op">;</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="bu">float</span> resistance <span class="op">=</span> RREF <span class="op">*</span> ratio<span class="op">;</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Calcula la temperatura utilizando el método de la librería</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="bu">float</span> raw_temp <span class="op">=</span> thermo.temperature(RNOMINAL, RREF)<span class="op">;</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Aplica la ecuación de calibración: <span class="fl">1.0582</span> <span class="op">*</span> temp <span class="op">+</span> (<span class="op">-</span><span class="fl">1.5553</span>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="bu">float</span> radiant_temp <span class="op">=</span> <span class="fl">1.0582</span> <span class="op">*</span> raw_temp <span class="op">-</span> <span class="fl">1.5553</span><span class="op">;</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> radiant_temp<span class="op">;</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="modern-device-wind-sensor-rev.-p6" class="level4">
<h4 class="anchored" data-anchor-id="modern-device-wind-sensor-rev.-p6">Modern Device Wind Sensor Rev.&nbsp;P6</h4>
<p>El sensor de viento Rev.&nbsp;P6 es un anemómetro de hilo caliente. Incorpora un potenciómetro de alta precisión para facilitar la calibración (realizada en fábrica) y utilizar termistores de coeficiente de temperatura positivo, que aseguran mediciones más estables incluso ante variaciones de temperatura ambiente. Requiere una fuente de alimentación de 9 a 12 V (idealmente 12 V) para garantizar el adecuado calentamiento de los termistores y evitar la saturación en condiciones de viento intenso. Integra un sensor de temperatura ambiental con salida escalada a 3.3 V y una señal de viento ajustada a un máximo de 3.3 V mediante resistencias de alta precisión. <span class="citation" data-cites="modern">ModernDevice (<a href="references.html#ref-modern" role="doc-biblioref">s.&nbsp;f.</a>)</span></p>
<div id="fig-WindSensor" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-WindSensor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src=".\images/windsensor_bb.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-WindSensor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.3: Diagrama de conexión para el Wind Sensor Rev.&nbsp;P6.
</figcaption>
</figure>
</div>
<p><strong>Especificaciones</strong></p>
<ul>
<li>Voltaje de alimentación: 10–12 V.</li>
<li>Corriente: Aproximadamente 40 mA.</li>
<li>Velocidades de viento medidas: 0–150 mph.</li>
<li>Compensación de temperatura ambiente.</li>
</ul>
<div id="aa397c2d" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-overflow-wrap code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#include &lt;math.h&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>const <span class="bu">int</span> OutPin  <span class="op">=</span> A0<span class="op">;</span>   <span class="op">//</span> Pin analógico para el sensor de viento (<span class="st">"OUT"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>const <span class="bu">int</span> TempPin <span class="op">=</span> A2<span class="op">;</span>   <span class="op">//</span> Pin analógico para el sensor de temperatura (<span class="st">"TMP"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Función que lee velocidad de viento y temperatura, y retorna un array de dos floats:</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> ws[<span class="dv">0</span>] <span class="op">-&gt;</span> velocidad de viento (m<span class="op">/</span>s)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> ws[<span class="dv">1</span>] <span class="op">-&gt;</span> temperatura (°C)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="bu">float</span><span class="op">*</span> WindSensor() {</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  static <span class="bu">float</span> ws[<span class="dv">2</span>]<span class="op">;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Lectura <span class="kw">del</span> sensor de viento</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="bu">int</span> windADunits <span class="op">=</span> analogRead(OutPin)<span class="op">;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="bu">float</span> voltage <span class="op">=</span> (<span class="bu">float</span>)windADunits <span class="op">*</span> <span class="fl">5.0</span> <span class="op">/</span> <span class="fl">1024.0</span><span class="op">;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Aplicar la corrección al voltaje</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="bu">float</span> correctedVoltage <span class="op">=</span> voltage <span class="op">-</span> <span class="fl">1.1621</span><span class="op">;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Lectura <span class="kw">del</span> sensor de temperatura</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="bu">int</span> tempRawAD <span class="op">=</span> analogRead(TempPin)<span class="op">;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="bu">float</span> tempC <span class="op">=</span> ((((<span class="bu">float</span>)tempRawAD <span class="op">*</span> <span class="fl">5.0</span>) <span class="op">/</span> <span class="fl">1024.0</span>) <span class="op">-</span> <span class="fl">0.400</span>) <span class="op">/</span> <span class="fl">0.0195</span><span class="op">;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> Cálculo de la velocidad de viento en m<span class="op">/</span>s usando la ecuación empírica:</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="op">//</span> WS <span class="op">=</span> <span class="fl">26.3431</span> <span class="op">*</span> (correctedVoltage)<span class="op">^</span>(<span class="fl">1.4273</span>) <span class="op">*</span> (tempC)<span class="op">^</span>(<span class="op">-</span><span class="fl">0.7631</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="bu">float</span> windSpeed <span class="op">=</span> <span class="fl">26.3431</span> <span class="op">*</span> <span class="bu">pow</span>(correctedVoltage, <span class="fl">1.4273</span>) <span class="op">*</span> <span class="bu">pow</span>(tempC, <span class="op">-</span><span class="fl">0.7631</span>)<span class="op">;</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  ws[<span class="dv">0</span>] <span class="op">=</span> windSpeed<span class="op">;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  ws[<span class="dv">1</span>] <span class="op">=</span> tempC<span class="op">;</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ws<span class="op">;</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="raspberry-pi-4-model-b" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="raspberry-pi-4-model-b"><span class="header-section-number">3.2.2</span> Raspberry Pi 4 Model B</h3>
<p>El Raspberry Pi 4 Model B es una computadora de placa única de alto rendimiento, diseñada para tareas de procesamiento avanzado y conectividad eficiente en un formato compacto. Equipada con un procesador de 64 bits de cuatro núcleos y opciones de RAM de hasta 8 GB, ofrece soporte para salida de video dual 4K y conectividad avanzada mediante Wi-Fi de doble banda, Bluetooth 5.0, Ethernet Gigabit y puertos USB 3.0, con capacidad para Power over Ethernet (PoE) mediante un accesorio adicional. Su diseño versátil y eficiente la hace ideal para la integración y gestión de datos en el sistema DTHIS-C. <span class="citation" data-cites="raspberry">Raspberry (<a href="references.html#ref-raspberry" role="doc-biblioref">2019</a>)</span></p>
<p>En la <a href="#tbl-raspberry" class="quarto-xref">Tabla&nbsp;<span>3.3</span></a> se muestran sus especificaciones.</p>
<div id="tbl-raspberry" class="hover sm quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-raspberry-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;3.3: Especificaciones del Raspberry Pi 4 Model B.
</figcaption>
<div aria-describedby="tbl-raspberry-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-hover table-sm small caption-top table">
<colgroup>
<col style="width: 36%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Parámetro</strong></th>
<th><strong>Detalle</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Procesador</td>
<td>Broadcom BCM2711, 4 núcleos Cortex-A72, 1.5 GHz</td>
</tr>
<tr class="even">
<td>Memoria RAM</td>
<td>8 GB (LPDDR4-3200)</td>
</tr>
<tr class="odd">
<td>Conectividad Wi-Fi</td>
<td>Sí, dual-band 2.4 GHz y 5 GHz, 802.11ac</td>
</tr>
<tr class="even">
<td>Bluetooth</td>
<td>Sí, Bluetooth 5.0</td>
</tr>
<tr class="odd">
<td>Puertos USB</td>
<td>2 USB 3.0, 2 USB 2.0</td>
</tr>
<tr class="even">
<td>Salida de video</td>
<td>2 micro HDMI, soporte dual 4K 60 fps</td>
</tr>
<tr class="odd">
<td>Ethernet</td>
<td>Gigabit</td>
</tr>
<tr class="even">
<td>Almacenamiento</td>
<td>Tarjeta microSD</td>
</tr>
<tr class="odd">
<td>Voltaje de operación</td>
<td>5V</td>
</tr>
<tr class="even">
<td>Consumo energético</td>
<td>Eficiente, sin ventilador (~3A recomendado)</td>
</tr>
<tr class="odd">
<td>Dimensiones</td>
<td>85.6 mm x 56.5 mm x 17 mm</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>El siguiente código constituye el programa principal del Raspberry Pi 4 Model B en el DTHIS-C, encargado de gestionar la conexión al servidor ThingsBoard mediante el protocolo MQTT y el envío de datos provenientes de sensores como el SCD30 (CO2, temperatura y humedad relativa). Escrito en Python, utiliza la librería <code>paho-mqtt</code> para la comunicación y está diseñado para operar de manera continua:</p>
<div id="3fa018e0" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-overflow-wrap code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> paho.mqtt.client <span class="im">as</span> mqtt</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> thingsboard_credentials <span class="im">import</span> thingsboard_data</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scd30 <span class="im">import</span> scd30_measurements</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sound <span class="im">import</span> sound_data</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtiene los datos de conexión para ThingsBoard</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>unique_id, token, thingsboard_host <span class="op">=</span> thingsboard_data()</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Diccionario para almacenar las lecturas del sensor</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>sensor_data <span class="op">=</span> {<span class="st">'CO2'</span>: <span class="dv">0</span>, <span class="st">'T'</span>: <span class="dv">0</span>, <span class="st">'HR'</span>: <span class="dv">0</span>}</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Diccionario para datos de sonido</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># micro_data = {'RMS': 0, 'dBmax': 0, 'dBmin': 0}  </span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Configura el cliente MQTT</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> mqtt.Client(unique_id, <span class="va">False</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>client.username_pw_set(token, password<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>client.<span class="ex">connect</span>(thingsboard_host, <span class="dv">1883</span>, <span class="dv">60</span>, <span class="st">''</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>client.loop_start()</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Obtiene las mediciones del sensor SCD30</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        CO2, T, HR <span class="op">=</span> scd30_measurements()</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Actualiza el diccionario con las lecturas actuales</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        sensor_data[<span class="st">'CO2'</span>] <span class="op">=</span> CO2</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>        sensor_data[<span class="st">'T'</span>] <span class="op">=</span> T</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>        sensor_data[<span class="st">'HR'</span>] <span class="op">=</span> HR</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Publica los datos del SCD30 en ThingsBoard</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        client.publish(<span class="st">'v1/devices/me/telemetry'</span>, json.dumps(sensor_data), <span class="dv">1</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Obtiene los datos de sonido</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># micro_data = sound_data() </span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Publica los datos de sonido en ThingsBoard</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># client.publish('v1/devices/me/telemetry', json.dumps(micro_data), 1)</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">2</span>)  <span class="co"># Ajusta el intervalo de tiempo entre lecturas</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Detiene el loop del cliente MQTT y desconecta del servidor</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>client.loop_stop()</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>client.disconnect()</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="sensirion-scd30" class="level4">
<h4 class="anchored" data-anchor-id="sensirion-scd30">Sensirion SCD30</h4>
<p>El SCD30 es un sensor de CO<sub>2</sub> basado en tecnología de detección por infrarrojos. Incorpora un sensor de humedad y temperatura. Cuenta con un diseño de doble canal. Además, ofrece una precisión de ±(30 ppm + 3% de la lectura) en un rango de 400 a 10,000 ppm. <span class="citation" data-cites="scd30">Sensirion (<a href="references.html#ref-scd30" role="doc-biblioref">s.&nbsp;f.</a>)</span></p>
<div id="fig-SCD30" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-SCD30-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src=".\images/scd30_bb.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-SCD30-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.4: Diagrama de conexión para el SCD30.
</figcaption>
</figure>
</div>
<p><strong>Especificaciones</strong></p>
<p><strong>CO<sub>2</sub></strong></p>
<ul>
<li>Rango de medición: 400 – 10,000 ppm</li>
<li>Precisión: ±30 ppm ±3% del valor medido</li>
<li>Tiempo de respuesta (τ63%): 20 s</li>
<li>Estabilidad térmica: 2.5 ppm/°C</li>
</ul>
<p><strong>Humedad</strong></p>
<ul>
<li>Precisión típica: ±3 %RH</li>
<li>Rango de operación: 0 – 95 %RH</li>
<li>Tiempo de respuesta (τ63%): 8 s</li>
<li>Certificación de calibración: Calibrado de fábrica</li>
<li>Temperatura</li>
<li>Precisión típica: ±0.4 °C</li>
<li>Tiempo de respuesta (τ63%): 10 s</li>
</ul>
<p><strong>Características generales</strong></p>
<ul>
<li>Voltaje de alimentación: 3.3 – 5.5 V</li>
<li>Corriente promedio: 19 mA</li>
<li>Corriente máxima: 75 mA</li>
<li>Rango de temperatura de operación: 0 – 50 °C</li>
<li>Interfaces: I²C, ModBus, PWM</li>
<li>Dimensiones: 35 × 23 × 7 mm</li>
</ul>
<p>A continuación se muestra el código de Python empleado para su incorpación al DTHIS-C:</p>
<div id="a2dd8020" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-overflow-wrap code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> board</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> busio</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scd30_i2c <span class="im">import</span> SCD30</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> scd30_measurements():</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Función para obtener las lecturas de CO2, Temperatura y Humedad Relativa del sensor SCD30.</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Retorna:</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">        tuple: (CO2, T, HR) donde</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">            CO2: concentración de CO2 en ppm</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">            T: temperatura en grados Celsius</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">            HR: humedad relativa en porcentaje</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Inicializa el sensor SCD30</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    scd30 <span class="op">=</span> SCD30()</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Espera para asegurarse de que el sensor esté listo</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">2</span>)  </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verifica si los datos están listos para ser leídos</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> scd30.get_data_ready():</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Lee las mediciones del sensor</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        CO2, T, HR <span class="op">=</span> scd30.read_measurement()</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Redondea cada valor a dos decimales</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>        CO2 <span class="op">=</span> <span class="bu">round</span>(CO2, <span class="dv">2</span>)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>        T <span class="op">=</span> <span class="bu">round</span>(T, <span class="dv">2</span>)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>        HR <span class="op">=</span> <span class="bu">round</span>(HR, <span class="dv">2</span>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> CO2, T, HR</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="arducam-5mp-ov5647-ultra-wide-angle" class="level4">
<h4 class="anchored" data-anchor-id="arducam-5mp-ov5647-ultra-wide-angle">Arducam 5MP OV5647 Ultra Wide Angle</h4>
<p>La cámara Arducam Ultra Wide Angle cuenta con un objetivo ojo de pez M12 que ofrece un campo de visión horizontal de 220°. <span class="citation" data-cites="arducam">Arducam (<a href="references.html#ref-arducam" role="doc-biblioref">s.&nbsp;f.</a>)</span></p>
<div id="fig-Camara" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Camara-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src=".\images/camera_bb.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Camara-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.5: Diagrama de conexión para la cámara OV5647.
</figcaption>
</figure>
</div>
<p><strong>Especificaciones</strong></p>
<ul>
<li>Sensor: Omnivision OV5647</li>
<li>Tamaño del sensor: 1/4″ (OV5647)</li>
<li>Resolución: 5 MP (2592×1944)</li>
<li>Video:
<ul>
<li>1080p a 30 fps</li>
<li>720p a 60 fps</li>
<li>480p a 90 fps</li>
</ul></li>
<li>Sensibilidad IR: Filtro IR-cut integrado (solo luz visible)</li>
<li>Campo de visión horizontal (HFOV): 220°</li>
<li>Distancia focal efectiva: 0.76 mm</li>
<li>Distancia focal equivalente en 35 mm: 8.2 mm</li>
<li>Tipo de enfoque: Manual</li>
<li>Montura del objetivo: M12</li>
<li>Dimensiones: 36 mm × 36 mm</li>
<li>Corriente pico: 300 mA</li>
</ul>
<p>A continuación, se muestra el código escrito en Bash/Shell que accede a la cámara y, posteriormente, genera los mapas de luminancia:</p>
<div id="863665b5" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-overflow-wrap code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>DATE<span class="op">=</span>$(date <span class="op">+</span><span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">_%H%M"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>IMG_DIR<span class="op">=</span><span class="st">"/home/hdeza/Luminance/images"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>HDR_IMG<span class="op">=</span><span class="st">"/home/hdeza/Luminance/HDR_images"</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>MAPS_DIR<span class="op">=</span><span class="st">"/home/hdeza/Luminance/maps"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>OUTPUT_DIR<span class="op">=</span><span class="st">"/home/hdeza/Luminance"</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Loop through shutter speeds and capture images</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>SHUTTERS<span class="op">=</span>(<span class="dv">100</span> <span class="dv">500</span> <span class="dv">1000</span> <span class="dv">5000</span> <span class="dv">10000</span> <span class="dv">50000</span> <span class="dv">100000</span> <span class="dv">500000</span> <span class="dv">1000000</span> <span class="dv">2000000</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="st">"${!SHUTTERS[@]}"</span><span class="op">;</span> do</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  rpicam<span class="op">-</span>still <span class="op">--</span>raw <span class="op">-</span>n <span class="op">--</span>gain <span class="dv">1</span> <span class="op">-</span>t <span class="dv">500</span> <span class="op">--</span>shutter <span class="st">"$</span><span class="sc">{SHUTTERS[$i]}</span><span class="st">"</span> <span class="op">-</span>o <span class="st">"$IMG_DIR/$(printf "</span><span class="op">%</span><span class="dv">0</span><span class="er">2d</span><span class="st">" $((i+1))).jpg"</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>done</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Run raw2hdr with the path to the images and save as image.hdr</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>raw2hdr <span class="op">-</span>a <span class="op">-</span>e <span class="op">-</span>g <span class="op">-</span>f <span class="op">-</span>h <span class="op">-</span>w <span class="op">-</span>o <span class="st">"$HDR_IMG/image_$DATE.hdr"</span> <span class="st">"$IMG_DIR"</span><span class="op">/*</span>dng</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Get info about the final HDR</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>getinfo <span class="st">"$HDR_IMG/image_$DATE.hdr"</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Nullify exposure value</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>ra_xyze <span class="op">-</span>r <span class="op">-</span>o <span class="st">"$HDR_IMG/image_$DATE.hdr"</span> <span class="op">&gt;</span> <span class="st">"$OUTPUT_DIR/image_nullEV_$DATE.hdr"</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Resize image</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>pfilt <span class="op">-</span><span class="dv">1</span> <span class="op">-</span>x <span class="dv">1000</span> <span class="op">-</span>y <span class="dv">1000</span> <span class="st">"$OUTPUT_DIR/image_nullEV_$DATE.hdr"</span> <span class="op">&gt;</span> <span class="st">"$OUTPUT_DIR/image_resize_$DATE.hdr"</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co">#Make photometric adjustment</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>pcomb <span class="op">-</span>s <span class="fl">1.8</span> <span class="st">"$OUTPUT_DIR/image_resize_$DATE.hdr"</span> <span class="op">&gt;</span> <span class="st">"$OUTPUT_DIR/image_photometric_$DATE.hdr"</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co">#Change view angle for fisheye</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>getinfo <span class="op">-</span>a <span class="st">"VIEW= -vta -vv 160 -vh 160"</span> <span class="op">&lt;</span> <span class="st">"$OUTPUT_DIR/image_photometric_$DATE.hdr"</span> <span class="op">&gt;</span> <span class="st">"$IMG_DIR/image_final_$DATE.hdr"</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co">#Print illuminance value</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>echo <span class="st">"Total illuminance is: "</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>evalglare <span class="op">-</span>V <span class="st">"$IMG_DIR/image_final_$DATE.hdr"</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>evalglare <span class="op">-</span>V <span class="st">"$IMG_DIR/image_final_$DATE.hdr"</span> <span class="op">&gt;</span> <span class="st">"$OUTPUT_DIR/illuminance_$DATE.txt"</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co">#Move final HDR image to HDR_images</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>mv <span class="st">"$IMG_DIR/image_final_$DATE.hdr"</span> <span class="st">"$HDR_IMG/image_final_$DATE.hdr"</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="co">#Crop to a 160</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>pcomb <span class="op">-</span>e <span class="st">'Cx:xmax/2;Cy:ymax/2;R:444.44;sq(x):x*x'</span> <span class="op">-</span>e <span class="st">'inC=sq(R)-sq(x-Cx)-sq(y-Cy)'</span> <span class="op">-</span>e <span class="st">'ro=if(inC,ri(1),0);go=if(inC,gi(1),0);bo=if(inC,bi(1),0)'</span> <span class="st">"$HDR_IMG/image_final_$DATE.hdr"</span> <span class="op">&gt;</span> <span class="st">"$HDR_IMG/image_crop_$DATE.hdr"</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="co">#Make the luminance map with configurations and save it</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>falsecolor <span class="op">-</span>s <span class="dv">5000</span> <span class="op">-</span>d <span class="dv">1</span> <span class="op">-</span>i <span class="st">"$HDR_IMG/image_crop_$DATE.hdr"</span> <span class="op">--</span>log <span class="dv">3</span> <span class="op">&gt;</span> <span class="st">"$MAPS_DIR/image_map_$DATE.hdr"</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="micrófono-ambiental-usb" class="level4">
<h4 class="anchored" data-anchor-id="micrófono-ambiental-usb">Micrófono ambiental USB</h4>
<p>El micrófono incorpora un filtro que atenúa eficazmente los ruidos producidos por el viento o la respiración. Su patrón de captación direccional optimiza la focalización de la fuente sonora. <span class="citation" data-cites="steren">Steren (<a href="references.html#ref-steren" role="doc-biblioref">s.&nbsp;f.</a>)</span></p>
<div id="fig-Microfono" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-Microfono-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src=".\images/micro_bb.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-Microfono-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.6: Diagrama de conexión para el micrófono.
</figcaption>
</figure>
</div>
<p><strong>Especificaciones</strong></p>
<ul>
<li>Respuesta en frecuencia: 50 a 10,000 Hz</li>
<li>Impedancia 2,200 <span class="math inline">\(\Omega\)</span></li>
<li>Sensibilidad: -32 dB ±3 dB</li>
</ul>
<p>A continuación, se presentan los códigos utilizados para la captura y análisis de sonido. Estos scripts permiten grabar el audio, extraer parámetros clave de la señal y convertirlos a valores en decibeles (dB).</p>
<p>El siguiente script graba un archivo de audio en formato WAV durante 15 segundos a una frecuencia de muestreo de 44.1 kHz:</p>
<div id="b17c16e7" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-overflow-wrap code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>grabar<span class="op">=</span><span class="st">"/home/hdeza/Sonido/audio.wav"</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>arecord <span class="op">-</span>D plughw:<span class="dv">3</span>,<span class="dv">0</span> <span class="op">-</span>f cd <span class="op">-</span>t wav <span class="op">-</span>d <span class="dv">15</span> <span class="op">-</span>r <span class="dv">44100</span> $grabar</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Posteriormente este script analiza el archivo de audio y extrae la amplitud máxima de la señal, almacenándola en un archivo de texto:</p>
<div id="9cec7a73" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-overflow-wrap code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>maximo<span class="op">=</span><span class="st">"/home/hdeza/Sonido/dBmax.txt"</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="op">/</span>usr<span class="op">/</span><span class="bu">bin</span><span class="op">/</span>sox <span class="op">/</span>home<span class="op">/</span>hdeza<span class="op">/</span>Sonido<span class="op">/</span>audio.wav <span class="op">-</span>n stat <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="op">|</span> <span class="op">/</span>usr<span class="op">/</span><span class="bu">bin</span><span class="op">/</span>grep <span class="st">"Maximum amplitude:"</span> <span class="op">|</span> <span class="op">/</span>usr<span class="op">/</span><span class="bu">bin</span><span class="op">/</span>awk <span class="st">'{print $3}'</span>  <span class="op">&gt;</span> $maximo</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Similar al anterior, este script obtiene la amplitud mínima del audio y la guarda en un archivo de texto:</p>
<div id="1b5a7f08" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-overflow-wrap code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>minimo<span class="op">=</span><span class="st">"/home/hdeza/Sonido/dBmin.txt"</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="op">/</span>usr<span class="op">/</span><span class="bu">bin</span><span class="op">/</span>sox <span class="op">/</span>home<span class="op">/</span>hdeza<span class="op">/</span>Sonido<span class="op">/</span>audio.wav <span class="op">-</span>n stat <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="op">|</span> <span class="op">/</span>usr<span class="op">/</span><span class="bu">bin</span><span class="op">/</span>grep <span class="st">"Minimum amplitude:"</span> <span class="op">|</span> <span class="op">/</span>usr<span class="op">/</span><span class="bu">bin</span><span class="op">/</span>awk <span class="st">'{print $3}'</span> <span class="op">&gt;</span> $minimo</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Este código calcula la amplitud RMS (Root Mean Square) del audio, un indicador de la potencia promedio de la señal sonora:</p>
<div id="9755c4c0" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-overflow-wrap code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>media<span class="op">=</span><span class="st">"/home/hdeza/Sonido/rms.txt"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="op">/</span>usr<span class="op">/</span><span class="bu">bin</span><span class="op">/</span>sox <span class="op">/</span>home<span class="op">/</span>hdeza<span class="op">/</span>Sonido<span class="op">/</span>audio.wav <span class="op">-</span>n stat <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="op">|</span> <span class="op">/</span>usr<span class="op">/</span><span class="bu">bin</span><span class="op">/</span>grep <span class="st">"RMS     amplitude:"</span> <span class="op">|</span> <span class="op">/</span>usr<span class="op">/</span><span class="bu">bin</span><span class="op">/</span>awk <span class="st">'{print $3}'</span> <span class="op">&gt;</span> $media</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>El código en Python lee los valores extraídos previamente (RMS, amplitud máxima y mínima) y los convierte a decibeles utilizando la fórmula:</p>
<p><span class="math display">\[dB = 20 \log_{10}(\text{amplitud}) + 120\]</span></p>
<p>Los valores resultantes son almacenados en un diccionario para su posterior uso:</p>
<div id="24b3e8eb" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-overflow-wrap code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sound_data():</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Función para obtener los datos de sonido desde archivos y calcular sus valores en dB.</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Retorna:</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">        dict: Datos de sonido en dB (RMS_dB, dBmax_dB, dBmin_dB).</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'/home/dthisc/dthis-c/sound/rms.txt'</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'/home/dthisc/dthis-c/sound/dBmax.txt'</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'/home/dthisc/dthis-c/sound/dBmin.txt'</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    rms_x <span class="op">=</span> <span class="st">""</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    dBmax_x <span class="op">=</span> <span class="st">""</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    dBmin_x <span class="op">=</span> <span class="st">""</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(archivo, <span class="st">'r'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> f:</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> archivo <span class="op">==</span> <span class="st">'/home/dthisc/dthis-c/sound/rms.txt'</span>:</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>                rms_x <span class="op">=</span> <span class="bu">round</span>(<span class="bu">float</span>(f.read().strip()), <span class="dv">4</span>)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> archivo <span class="op">==</span> <span class="st">'/home/dthisc/dthis-c/sound/dBmax.txt'</span>:</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>                dBmax_x <span class="op">=</span> <span class="bu">round</span>(<span class="bu">float</span>(f.read().strip()), <span class="dv">4</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> archivo <span class="op">==</span> <span class="st">'/home/dthisc/dthis-c/sound/dBmin.txt'</span>:</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>                dBmin_x <span class="op">=</span> <span class="bu">round</span>(<span class="bu">float</span>(f.read().strip()), <span class="dv">4</span>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    rms_db <span class="op">=</span> <span class="bu">round</span>(<span class="dv">20</span> <span class="op">*</span> np.log10(<span class="bu">float</span>(rms_x)) <span class="op">+</span> <span class="dv">120</span>, <span class="dv">4</span>)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    dBmax_db <span class="op">=</span> <span class="bu">round</span>(<span class="dv">20</span> <span class="op">*</span> np.log10(<span class="bu">float</span>(dBmax_x)) <span class="op">+</span> <span class="dv">120</span>, <span class="dv">4</span>)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    dBmin_db <span class="op">=</span> <span class="bu">round</span>(<span class="dv">20</span> <span class="op">*</span> np.log10(<span class="bu">abs</span>(<span class="bu">float</span>(dBmin_x))) <span class="op">+</span> <span class="dv">120</span>, <span class="dv">4</span>)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">'RMS'</span>: rms_db, <span class="st">'dBmax'</span>: dBmax_db, <span class="st">'dBmin'</span>: dBmin_db}</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="sec-materiales" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-materiales"><span class="header-section-number">3.3</span> Lista de materiales</h2>
<p>La <a href="#tbl-materiales" class="quarto-xref">Tabla&nbsp;<span>3.4</span></a> muestra la lista de materiales necesarios para la construcción del DTHIS-C, detallando la cantidad de cada componente, los costos y la fuente de venta.</p>
<div id="tbl-materiales" class="hover sm quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-materiales-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;3.4: Lista de materiales para la construcción del DTHIS-C.
</figcaption>
<div aria-describedby="tbl-materiales-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-hover table-sm small caption-top table">
<thead>
<tr class="header">
<th><strong>Designación</strong></th>
<th><strong>Componente</strong></th>
<th><strong>Cantidad</strong></th>
<th><strong>Costo unitario (MXN)</strong></th>
<th><strong>Costo total (MXN)</strong></th>
<th><strong>Fuente de compra</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Adaptador USB</td>
<td>UGREEN Adaptador USB C Hembra a USB Macho 3</td>
<td>1</td>
<td>$199.00</td>
<td>$199.00</td>
<td><a href="https://a.co/d/arZqIaH">Amazon</a></td>
</tr>
<tr class="even">
<td>Arduino</td>
<td>Arduino UNO WiFi Rev2</td>
<td>1</td>
<td>$1,268.10</td>
<td>$1,268.10</td>
<td><a href="https://www.agelectronica.com/detalle?busca=ABX00021">AG Electrónica</a></td>
</tr>
<tr class="odd">
<td>Cable para cámara Raspberry</td>
<td>OKY9053</td>
<td>1</td>
<td>$27.59</td>
<td>$27.59</td>
<td><a href="https://www.agelectronica.com/detalle?busca=OKY9053">AG Electrónica</a></td>
</tr>
<tr class="even">
<td>Carcasa</td>
<td>Carcasa ABS para Raspberry Pi 4 con ventilador y disipadores de calor</td>
<td>1</td>
<td>$188.00</td>
<td>$188.00</td>
<td><a href="https://www.330ohms.com/collections/carcasas-rpi/products/carcasa-abs-para-raspberry-pi-4-con-ventilador-y-disipadores-de-calor">330ohms</a></td>
</tr>
<tr class="odd">
<td>Fisheye</td>
<td>5MP OV5647 Wide Angle Fisheye Camera</td>
<td>1</td>
<td>$502.59</td>
<td>$502.59</td>
<td><a href="https://www.agelectronica.com/detalle?busca=SKU10344*">AG Electrónica</a></td>
</tr>
<tr class="even">
<td>Fuente de alimentación</td>
<td>DC 12 V 30 A Fuente de alimentación 360 W</td>
<td>1</td>
<td>$382.00</td>
<td>$382.00</td>
<td><a href="https://a.co/d/dZtxNhR">Amazon</a></td>
</tr>
<tr class="odd">
<td>Fuente para Arduino</td>
<td>Aclorol 9V 1A DC Fuente de alimentación</td>
<td>2</td>
<td>$269.00</td>
<td>$538.00</td>
<td><a href="https://a.co/d/6nRFb6V">Amazon</a></td>
</tr>
<tr class="even">
<td>Fuente para Raspberry</td>
<td>Fuente oficial para Raspberry Pi 27W USB-C</td>
<td>1</td>
<td>$370.00</td>
<td>$370.00</td>
<td><a href="https://www.330ohms.com/collections/raspberry-pi-5/products/fuente-oficial-para-raspberry-pi-27w-usb-c?src=raspberrypi">330ohms</a></td>
</tr>
<tr class="odd">
<td>MAX31856</td>
<td>PWFusion SEN-30007 MAX31856</td>
<td>1</td>
<td>≈ $1,493.10</td>
<td>≈ $1,493.10</td>
<td><a href="https://www.playingwithfusion.com/productview.php?catid=0&amp;pdid=71">Playing With Fusion</a></td>
</tr>
<tr class="even">
<td>MAX31865</td>
<td>Adafruit PT1000 RTD-MAX31865</td>
<td>1</td>
<td>≈ $269.10</td>
<td>≈ $269.10</td>
<td><a href="https://www.adafruit.com/product/3648">Adafruit</a></td>
</tr>
<tr class="odd">
<td>Micro SD</td>
<td>Memoria Microsd Kingston Canvas Go Plus 64gb U3 V30 A2 170mb</td>
<td>1</td>
<td>$194.00</td>
<td>$194.00</td>
<td><a href="https://articulo.mercadolibre.com.mx/MLM-1509193544-memoria-microsd-kingston-canvas-go-plus-64gb-u3-v30-a2-170mb-_JM">Mercado Libre</a></td>
</tr>
<tr class="even">
<td>Micrófono</td>
<td>Micrófono ambiental USB</td>
<td>1</td>
<td>$99.00</td>
<td>$99.00</td>
<td><a href="https://www.steren.com.mx/microfono-usb-c-de-solapa-para-celular.html">Steren</a></td>
</tr>
<tr class="odd">
<td>Raspberry</td>
<td>Raspberry Pi 4 Model B 8 GB</td>
<td>1</td>
<td>$1,990.52</td>
<td>$1,990.52</td>
<td><a href="https://www.agelectronica.com/detalle?busca=RASPBERRYPI-4-MODB%25sum-8GB">AG Electrónica</a></td>
</tr>
<tr class="even">
<td>SCD30</td>
<td>SCD30 Sensirion</td>
<td>1</td>
<td>≈ $563.94</td>
<td>≈ $563.94</td>
<td><a href="https://www.digikey.com.mx/es/products/detail/sensirion-ag/SCD30/8445334">DigiKey</a></td>
</tr>
<tr class="odd">
<td>Termopar</td>
<td>Termopar tipo T</td>
<td>30 m</td>
<td>$3,735.00</td>
<td>$3,735.00</td>
<td><a href="https://mx.omega.com/pptst/GG_T_TC_WIRE.html#order">Omega</a></td>
</tr>
<tr class="even">
<td>TPF1</td>
<td>TPF1/E-20 PT1000</td>
<td>1</td>
<td>≈ $1,576.60</td>
<td>≈ $1,576.60</td>
<td><a href="https://www.fuehlersysteme.de/Radiation-Pendulum-Temperature-Sensor_1">FuehlerSysteme</a></td>
</tr>
<tr class="odd">
<td>Tripié</td>
<td>XXZU 210 cm soporte de luz</td>
<td>1</td>
<td>$539.10</td>
<td>$539.10</td>
<td><a href="https://a.co/d/1OlLE51">Amazon</a></td>
</tr>
<tr class="even">
<td>Wind Sensor</td>
<td>Wind Sensor Rev P6</td>
<td>1</td>
<td>≈ $719.10</td>
<td>≈ $719.10</td>
<td><a href="https://moderndevice.com/products/wind-sensor-rev-p">Modern Device</a></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p><em>Nota: Los precios no incluyen envío y pueden estar sujetos a cambios según el destino del producto.</em></p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-adafruit" class="csl-entry" role="listitem">
Adafruit. s.&nbsp;f. <span>«Adafruit PT1000 RTD Temperature Sensor Amplifier - MAX31865»</span>. <a href="https://www.adafruit.com/product/3648#description">https://www.adafruit.com/product/3648#description</a>.
</div>
<div id="ref-arducam" class="csl-entry" role="listitem">
Arducam. s.&nbsp;f. <span>«Arducam 5MP OV5647 Ultra Wide Angle Fisheye Camera for Raspberry Pi»</span>. <a href="https://www.arducam.com/product/arducam-ultra-wide-angle-fisheye-5mp-ov5647-camera-for-raspberry-pi/">https://www.arducam.com/product/arducam-ultra-wide-angle-fisheye-5mp-ov5647-camera-for-raspberry-pi/</a>.
</div>
<div id="ref-arduino" class="csl-entry" role="listitem">
Arduino. 2023. <span>«Arduino UNO WiFi Rev2»</span>. <a href="https://store.arduino.cc/products/arduino-uno-wifi-rev2">https://store.arduino.cc/products/arduino-uno-wifi-rev2</a>.
</div>
<div id="ref-fuehler" class="csl-entry" role="listitem">
FuehlerSysteme. s.&nbsp;f. <span>«Radiation Pendulum Temperature Sensor»</span>. <a href="https://www.fuehlersysteme.de/Radiation-Pendulum-Temperature-Sensor_1#70bd/embedded/">https://www.fuehlersysteme.de/Radiation-Pendulum-Temperature-Sensor_1#70bd/embedded/</a>.
</div>
<div id="ref-modern" class="csl-entry" role="listitem">
ModernDevice. s.&nbsp;f. <span>«Wind Sensor Rev. P»</span>. <a href="https://moderndevice.com/products/wind-sensor-rev-p">https://moderndevice.com/products/wind-sensor-rev-p</a>.
</div>
<div id="ref-omega" class="csl-entry" role="listitem">
OMEGA. s.&nbsp;f. <span>«¿Qué es un sensor termopar?»</span> <a href="https://es.omega.com/prodinfo/termopares.html#">https://es.omega.com/prodinfo/termopares.html#</a>.
</div>
<div id="ref-pwf" class="csl-entry" role="listitem">
PWFusion. s.&nbsp;f. <span>«4-Channel T-Type Thermocouple MAX31856 SPI Digital Arduino Shield»</span>. <a href="https://www.playingwithfusion.com/productview.php?pdid=71&amp;catid=1008">https://www.playingwithfusion.com/productview.php?pdid=71&amp;catid=1008</a>.
</div>
<div id="ref-raspberry" class="csl-entry" role="listitem">
Raspberry. 2019. <span>«Raspberry Pi 4 Model B»</span>. <a href="https://www.raspberrypi.com/products/raspberry-pi-4-model-b/">https://www.raspberrypi.com/products/raspberry-pi-4-model-b/</a>.
</div>
<div id="ref-scd30" class="csl-entry" role="listitem">
Sensirion. s.&nbsp;f. <span>«SCD30»</span>. <a href="https://sensirion.com/products/catalog/SCD30">https://sensirion.com/products/catalog/SCD30</a>.
</div>
<div id="ref-steren" class="csl-entry" role="listitem">
Steren. s.&nbsp;f. <span>«Micrófono USB C de solapa para celular»</span>. <a href="https://www.steren.com.mx/microfono-usb-c-de-solapa-para-celular.html">https://www.steren.com.mx/microfono-usb-c-de-solapa-para-celular.html</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chapter_2.html" class="pagination-link" aria-label="Confort y calidad del aire en espacios interiores">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Confort y calidad del aire en espacios interiores</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chapter_4.html" class="pagination-link" aria-label="Calibración y referenciación del DTHIS-C">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Calibración y referenciación del DTHIS-C</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>